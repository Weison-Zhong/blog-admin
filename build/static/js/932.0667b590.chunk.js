"use strict";(self.webpackChunkblog_admin=self.webpackChunkblog_admin||[]).push([[932,388],{1361:function(e,n,r){r.d(n,{Z:function(){return l}});var t=r(885),a=r(7313),s=r(1821),i=r(5524),c=r(2138),u=r(6417);function l(e){var n=e.imageUrl,r=e.setImageUrl,l=e.fileChange,d=(0,a.useState)(!1),p=(0,t.Z)(d,2),f=p[0],h=p[1];var x=(0,u.jsxs)("div",{children:[f?(0,u.jsx)(i.Z,{}):(0,u.jsx)(c.Z,{}),(0,u.jsx)("div",{style:{marginTop:8},children:"\u70b9\u51fb\u4e0a\u4f20\u56fe\u7247"})]});return(0,u.jsx)(s.Upload,{listType:"picture",showUploadList:!1,customRequest:function(){h(!0)},beforeUpload:o,onChange:function(e){var n=e.file.originFileObj;l(n),function(e,n){var r=new FileReader;r.addEventListener("load",(function(){return n(r.result)})),r.readAsDataURL(e)}(n,(function(e){r(e),h(!1)}))},className:"img-upload-container",children:n?(0,u.jsx)("img",{src:n,alt:"avatar",style:{width:"100%"}}):x})}function o(e){var n="image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type;n||s.message.error("\u4ec5\u53ef\u4e0a\u4f20png\u6216jpg,jpeg\u683c\u5f0f\u56fe\u7247");var r=e.size/1024/1024<3;return r||s.message.error("\u56fe\u7247\u6587\u4ef6\u4e0d\u80fd\u5927\u4e8e 3MB"),n&&r}},8932:function(e,n,r){r.r(n),r.d(n,{default:function(){return b}});var t=r(2982),a=r(5861),s=r(885),i=r(7757),c=r.n(i),u=r(7313),l=(r(3388),r(7502)),o=r.n(l),d=r(2209),p=r(1821),f=r(2138),h=r(1361),x=r(3830),m=r(2239),g=r(6417),j=p.Form.Item,v=p.Select.Option,w=null;function b(){var e=u.createRef(),n=(0,u.useState)(""),r=(0,s.Z)(n,2),i=r[0],l=r[1],b=(0,u.useState)([]),k=(0,s.Z)(b,2),y=k[0],C=k[1],Z=(0,u.useState)(""),S=(0,s.Z)(Z,2),F=S[0],I=S[1],U=(0,u.useState)(!1),R=(0,s.Z)(U,2),N=R[0],q=R[1],D=(0,u.useState)(""),L=(0,s.Z)(D,2),T=L[0],E=L[1],K=(0,u.useState)({}),z=(0,s.Z)(K,2),O=z[0],P=z[1],V=(0,x.k6)(),_=function(){var e=(0,a.Z)(c().mark((function e(){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.KK)();case 2:if(n=e.sent,"undefined"!==typeof(r=n.data)){e.next=6;break}return e.abrupt("return");case 6:C(r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=(0,a.Z)(c().mark((function e(n){var r,t,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(!0),e.next=3,(0,d.Yu)(n);case 3:r=e.sent,q(!1),t=r.data,200===r.code&&(a=t.content,s=t.coverImgUrl,P(t),l(a),I(s));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),B=function(e){e.preventDefault(),T&&(C([].concat((0,t.Z)(y),[T])),E(""))},M=function(){var n=(0,a.Z)(c().mark((function n(){var r,t,a,s,u,l,o,f;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return q(!0),n.prev=1,r=(O||{}).id,n.next=5,e.current.validateFields();case 5:for(s in(t=n.sent).status=Number(t.status),a=new FormData,t)a.append(s,t[s]);if(a.append("content",i),a.append("coverImage",w),u=null,!r){n.next=18;break}return n.next=15,(0,d.K4)(r,a);case 15:u=n.sent,n.next=21;break;case 18:return n.next=20,(0,d.mF)(a);case 20:u=n.sent;case 21:if(q(!1),o=(l=u).code,f=l.msg,200===o){n.next=25;break}return n.abrupt("return");case 25:r?p.message.success(f):(p.message.success("\u65b0\u589e\u6587\u7ae0\u6210\u529f\uff0c\u6b63\u524d\u5f80\u5217\u8868\u9875"),setTimeout((function(){V.push("/article/list")}),500)),n.next=33;break;case 28:n.prev=28,n.t0=n.catch(1),p.message.error("\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"),q(!1),console.log("Failed:",n.t0);case 33:case"end":return n.stop()}}),n,null,[[1,28]])})));return function(){return n.apply(this,arguments)}}();return(0,u.useEffect)((function(){_();var e=((0,m.DP)()||{}).articleId;e&&A(e)}),[]),(0,u.useEffect)((function(){e.current&&e.current.setFieldsValue(O)}),[O,e]),(0,g.jsxs)("div",{className:"article-edit",children:[(0,g.jsx)(p.Form,{ref:e,className:"form",children:(0,g.jsxs)(p.Row,{gutter:2,children:[(0,g.jsxs)(p.Col,{span:16,children:[(0,g.jsx)(j,{name:"title",label:"\u6807\u9898",rules:[{required:!0}],children:(0,g.jsx)(p.Input,{allowClear:!0})}),(0,g.jsx)(j,{name:"relatedLink",label:"\u94fe\u63a5",rules:[{required:!0}],children:(0,g.jsx)(p.Input,{allowClear:!0})}),(0,g.jsxs)(p.Row,{gutter:2,children:[(0,g.jsx)(p.Col,{span:12,children:(0,g.jsx)(j,{name:"articleType",label:"\u7c7b\u578b",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7c7b\u578b"}],children:(0,g.jsx)(p.Select,{style:{width:220},placeholder:"\u8bf7\u9009\u62e9\u6587\u7ae0\u7c7b\u578b",dropdownRender:function(e){return(0,g.jsxs)(g.Fragment,{children:[e,(0,g.jsx)(p.Divider,{style:{margin:"8px 0"}}),(0,g.jsxs)(p.Space,{align:"center",style:{padding:"0 8px 4px"},children:[(0,g.jsx)(p.Input,{placeholder:"\u65b0\u589e\u6587\u7ae0\u7c7b\u578b",value:T,onChange:function(e){return E(e.target.value)}}),(0,g.jsx)(p.Typography.Link,{onClick:B,style:{whiteSpace:"nowrap"},children:(0,g.jsx)(f.Z,{})})]})]})},children:y.map((function(e){return(0,g.jsx)(v,{children:e},e)}))})})}),(0,g.jsx)(p.Col,{span:6,children:(0,g.jsx)(j,{label:"\u72b6\u6001",name:"status",rules:[{required:!1}],valuePropName:"checked",initialValue:!0,children:(0,g.jsx)(p.Switch,{checkedChildren:"\u4e0a\u67b6",unCheckedChildren:"\u9690\u85cf"})})})]})]}),(0,g.jsx)(p.Col,{span:8,children:(0,g.jsx)(j,{className:"img-upload-container",children:(0,g.jsx)(h.Z,{imageUrl:F,setImageUrl:I,fileChange:function(e){w=e}})})})]})}),(0,g.jsx)(o(),{onSave:M,subfield:!0,preview:!0,value:i,onChange:function(e){return l(e)}}),(0,g.jsx)(p.Spin,{delay:800,size:"large",tip:"\u52a0\u8f7d\u4e2d...",spinning:N})]})}},3388:function(e,n,r){r.r(n)}}]);